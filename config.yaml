# Repo2Doc 配置文件

# 文件筛选配置
file_filter:
  # 包含的文件扩展名
  include_extensions:
    - ".py"
    - ".js"
    - ".jsx"
    - ".ts"
    - ".tsx"
    - ".java"
    - ".go"
    - ".rs"
    - ".cpp"
    - ".c"
    - ".h"
    - ".hpp"
    - ".cs"
    - ".rb"
    - ".php"
    - ".swift"
    - ".kt"
    - ".scala"
    - ".vue"
    - ".svelte"
  
  # 排除的目录模式（支持 glob）
  exclude_patterns:
    - "**/node_modules/**"
    - "**/.git/**"
    - "**/venv/**"
    - "**/__pycache__/**"
    - "**/dist/**"
    - "**/build/**"
    - "**/.venv/**"
    - "**/vendor/**"
    - "**/*.min.js"
    - "**/*.min.css"
    - "**/test/**"
    - "**/tests/**"
    - "**/*_test.py"
    - "**/*_test.go"
    - "**/*.test.ts"
    - "**/*.spec.ts"
  
  # 最大文件大小（字节），超过此大小的文件将被跳过
  max_file_size: 102400  # 100KB
  
  # 最大文件数量
  max_files: 500

# LLM 配置
llm:
  # 模型名称
  model: "qwen3-max"
  
  # 温度参数
  temperature: 0.3
  
  # 最大输入 token 数（用于分块）
  max_input_tokens: 500000
  
  # 每个代码块预留的 token 数（用于 prompt 和输出）
  reserved_tokens: 10000
  
  # API 基础 URL（可选，用于兼容其他 API）
  # base_url: "https://api.openai.com/v1"

# 输出配置
output:
  # 输出目录（相对于仓库根目录）
  output_dir: "./repo2doc-output"
  
  # 输出文件名
  filename: "requirements.md"
  
  # 是否保存中间结果
  save_intermediate: true

# 提示词配置
prompts:
  # 系统提示词（用于所有请求）
  system: |
    你是一位资深的软件架构师和需求分析师。你的任务是根据代码库的源代码，逆向推导出该项目的需求规格说明书。

    ## 输出要求

    请生成一份结构清晰、内容完整的需求文档，包含以下部分：

    ### 1. 系统概述
    - 系统名称和简介
    - 系统的核心目标和价值
    - 主要用户群体

    ### 2. 功能需求
    - 核心功能模块
    - 每个模块的详细功能点
    - 功能之间的关系

    ### 3. 数据实体
    - 核心数据实体定义
    - 实体的属性和字段
    - 实体之间的关系

    ### 4. 业务流程
    - 主要业务流程描述
    - 用户交互流程

    ### 5. 非功能需求（如果能从代码推断）
    - 性能要求
    - 安全要求
    - 其他约束

    ## 注意事项
    1. 基于代码实际内容进行推断，不要臆造功能
    2. 使用清晰的中文描述
    3. 保持文档结构的一致性
    4. 如果某些信息无法从代码推断，可以标注"待确认"

  # 首次生成提示词（第一个代码块）
  first_chunk: |
    请分析以下代码，生成需求规格说明书。

    ## 代码内容

    {code_content}

    ## 说明

    这是代码库的第 {chunk_index} 块（共 {total_chunks} 块）。请基于这些代码生成需求文档。

  # 增量更新提示词（后续代码块）
  incremental: |
    你是一位资深的软件架构师和需求分析师。

    ## 当前任务

    我正在分析一个代码库，由于代码量较大，我将代码分成多个块逐步分析。

    ### 之前的分析结果

    以下是基于之前代码块生成的需求文档：

    {previous_document}

    ### 新的代码块

    现在我将提供新的代码块，请你：

    1. 分析新代码块中的功能和实体
    2. 将新发现的内容**合并**到现有文档中
    3. 如果发现与现有文档冲突的信息，请更新为更准确的描述
    4. 保持文档结构的完整性和一致性
    5. 不要删除之前文档中已有的有效内容

    ## 输出要求

    请输出**完整的、更新后的**需求文档，包含之前的内容和新发现的内容。

  # 后续块提示词（增量更新的用户消息）
  next_chunk: |
    请分析以下新的代码块，并更新需求文档。

    ## 新代码内容

    {code_content}

    ## 说明

    这是代码库的第 {chunk_index} 块（共 {total_chunks} 块）。
    请将新发现的功能和实体合并到现有文档中，输出完整的更新后文档。

# 日志配置
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
