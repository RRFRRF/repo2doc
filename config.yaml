# Repo2Doc 配置文件

# 文件筛选配置
file_filter:
  # 包含的文件扩展名
  include_extensions:
    - ".py"
    - ".js"
    - ".jsx"
    - ".ts"
    - ".tsx"
    - ".java"
    - ".go"
    - ".rs"
    - ".cpp"
    - ".c"
    - ".h"
    - ".hpp"
    - ".cs"
    - ".rb"
    - ".php"
    - ".swift"
    - ".kt"
    - ".scala"
    - ".vue"
    - ".svelte"
  
  # 排除的目录模式（支持 glob）
  exclude_patterns:
    - "**/node_modules/**"
    - "**/.git/**"
    - "**/venv/**"
    - "**/__pycache__/**"
    - "**/dist/**"
    - "**/build/**"
    - "**/.venv/**"
    - "**/vendor/**"
    - "**/*.min.js"
    - "**/*.min.css"
    - "**/test/**"
    - "**/tests/**"
    - "**/*_test.py"
    - "**/*_test.go"
    - "**/*.test.ts"
    - "**/*.spec.ts"
  
  # 最大文件大小（字节），超过此大小的文件将被跳过
  max_file_size: 102400  # 100KB
  
  # 最大文件数量
  max_files: 500

# LLM 配置
llm:
  # 模型名称（可选，优先env）
  # model: "qwen3-max"
  
  # 温度参数
  temperature: 0.3
  
  # 最大输入 token 数（用于分块）
  max_input_tokens: 500000
  
  # 每个代码块预留的 token 数（用于 prompt 和输出）
  reserved_tokens: 10000
  
  # API 基础 URL（可选，用于兼容其他 API）
  # base_url: "https://api.openai.com/v1"

# 输出配置
output:
  # 输出目录（相对于仓库根目录）
  output_dir: "./repo2doc-output"
  
  # 输出文件名
  filename: "requirements.md"
  
  # 是否保存中间结果
  save_intermediate: true

# 提示词配置
prompts:
  # 系统提示词（用于所有请求）
  system: |
    # 角色定义
    你是一位资深的软件架构师和需求分析专家，擅长通过代码逆向工程推导软件需求规格说明书（SRS）。

    # 核心任务
    根据提供的代码库源代码，生成一份专业、完整的软件需求规格说明书。

    # 输出规范

    ## 1. 项目概述
    - **项目名称**：从代码或配置中提取
    - **项目简介**：50-100字的核心描述
    - **技术栈**：使用的编程语言、框架、数据库等
    - **目标用户**：主要使用者群体

    ## 2. 功能需求（按模块组织）
    对每个功能模块：
    - **模块名称**：清晰的模块标识
    - **功能描述**：该模块的主要职责
    - **核心功能点**：具体功能列表（使用编号）
    - **业务规则**：相关的业务逻辑约束
    - **依赖关系**：与其他模块的交互

    ## 3. 数据模型
    - **核心实体**：实体名称、属性、数据类型
    - **实体关系**：实体之间的关联（一对一、一对多等）
    - **数据约束**：必填字段、唯一性、外键等

    ## 4. 接口设计（如有）
    - **API 端点**：路径、方法、参数
    - **请求/响应格式**
    - **认证方式**

    ## 5. 业务流程
    - **核心流程**：用户操作的主要路径
    - **状态转换**：关键状态及其转换条件

    ## 6. 非功能需求
    - **性能要求**：并发、响应时间等
    - **安全机制**：认证、授权、加密
    - **可扩展性**：设计上的扩展考虑

    # 写作规范
    1. 使用专业、准确的中文技术术语
    2. 基于代码实际内容推断，不臆造功能
    3. 无法确定的内容标注「⚠️ 待确认」
    4. 保持层次清晰，使用Markdown格式
    5. 功能描述应具体可测试

  # 首次生成提示词（第一个代码块）
  first_chunk: |
    # 任务：初始需求文档生成

    请分析以下代码块，生成需求规格说明书的初版。

    ## 代码内容
    ```
    {code_content}
    ```

    ## 上下文信息
    - 当前进度：第 {chunk_index} 块 / 共 {total_chunks} 块
    - 这是第一个代码块，请建立文档的整体框架

    ## 输出要求
    1. 建立完整的文档结构框架
    2. 提取所有可识别的功能模块
    3. 识别数据实体和关系
    4. 对于尚未分析的部分，留出占位符

  # 增量更新提示词（后续代码块）
  incremental: |
    # 角色：需求文档更新专家

    你正在协助完成一个大型代码库的需求文档生成任务。

    ## 当前文档状态
    以下是基于之前代码块生成的需求文档：

    {previous_document}

    ## 更新策略
    1. **保留**：已有的准确内容必须保留
    2. **补充**：新发现的功能和实体添加到对应章节
    3. **修正**：发现冲突时更新为更准确的描述
    4. **细化**：将「待确认」改为确定内容（如有依据）

    ## 注意事项
    - 保持文档结构一致性
    - 新增内容应无缝融入现有结构
    - 不要重复已有内容

  # 后续块提示词（增量更新的用户消息）
  next_chunk: |
    # 新代码块分析

    请分析以下新的代码块，并更新需求文档。

    ## 新代码内容
    ```
    {code_content}
    ```

    ## 进度信息
    - 当前：第 {chunk_index} 块 / 共 {total_chunks} 块

    ## 输出要求
    输出**完整的、更新后的**需求文档，包含：
    1. 所有之前的有效内容
    2. 本次新发现的功能和实体
    3. 任何必要的修正和细化

# 日志配置
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
