# Repo2Doc

åŸºäº LangGraph çš„ä»£ç åº“é€†å‘éœ€æ±‚æ–‡æ¡£ç”Ÿæˆå·¥å…·ã€‚

## æ¦‚è¿°

Repo2Doc æ˜¯ä¸€ä¸ªä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä»ä»£ç åº“è‡ªåŠ¨ç”Ÿæˆéœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦çš„å·¥å…·ã€‚å®ƒå€Ÿé‰´äº† [swark](https://github.com/swark-io/swark) çš„è®¾è®¡æ€æƒ³ï¼Œå®ç°äº†æ–‡ä»¶ç­›é€‰ã€ä»£ç åˆ†å—ã€å¢é‡å¼æ–‡æ¡£ç”Ÿæˆç­‰åŠŸèƒ½ã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸ” **æ™ºèƒ½æ–‡ä»¶ç­›é€‰**ï¼šæ”¯æŒæŒ‰æ‰©å±•ååŒ…å«ã€æŒ‰æ¨¡å¼æ’é™¤
- ğŸ“¦ **è‡ªåŠ¨åˆ†å—**ï¼šæ ¹æ® LLM token é™åˆ¶è‡ªåŠ¨åˆ†å—
- ğŸ”„ **å¢é‡å¼ç”Ÿæˆ**ï¼šæ¯ä¸ªå—ç”Ÿæˆåä¸ä¹‹å‰çš„æ–‡æ¡£åˆå¹¶
- ğŸ“Š **è¯¦ç»†æŠ¥å‘Š**ï¼šç”Ÿæˆå¤„ç†æŠ¥å‘Šå’Œä¸­é—´ç»“æœ
- âš™ï¸ **çµæ´»é…ç½®**ï¼šæ”¯æŒ YAML é…ç½®æ–‡ä»¶

## å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¾“å…¥ä»“åº“è·¯å¾„   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. æ‰«ææ–‡ä»¶    â”‚  æ‰«æç›®å½•ï¼Œè·å–æ‰€æœ‰æ–‡ä»¶
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ç­›é€‰æ–‡ä»¶    â”‚  æŒ‰æ‰©å±•åå’Œæ’é™¤è§„åˆ™ç­›é€‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. åˆ†å—æ–‡ä»¶    â”‚  æŒ‰ token é™åˆ¶åˆ†å—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ç”Ÿæˆæ–‡æ¡£    â”‚  LLM å¢é‡å¼ç”Ÿæˆ
â”‚    (å¾ªç¯å¤„ç†)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. ä¿å­˜è¾“å‡º    â”‚  ä¿å­˜æ–‡æ¡£å’ŒæŠ¥å‘Š
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å®‰è£…

### ä½¿ç”¨ uvï¼ˆæ¨èï¼‰

```bash
cd repo2doc
uv sync
```

### ä½¿ç”¨ pip

```bash
pip install -e .
```

## é…ç½®

### ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œè®¾ç½® API å¯†é’¥ï¼š

```bash
OPENAI_API_KEY="your-api-key-here"

# å¯é€‰ï¼šè‡ªå®šä¹‰ API åŸºç¡€ URL
# OPENAI_BASE_URL="https://api.openai.com/v1"
```

### é…ç½®æ–‡ä»¶

ç¼–è¾‘ `config.yaml` è‡ªå®šä¹‰é…ç½®ï¼š

```yaml
# æ–‡ä»¶ç­›é€‰é…ç½®
file_filter:
  include_extensions:
    - ".py"
    - ".js"
    - ".ts"
  exclude_patterns:
    - "**/node_modules/**"
    - "**/__pycache__/**"
  max_file_size: 102400  # 100KB
  max_files: 500

# LLM é…ç½®
llm:
  model: "gpt-4o"
  temperature: 0.3
  max_input_tokens: 100000
  reserved_tokens: 10000

# è¾“å‡ºé…ç½®
output:
  output_dir: "./repo2doc-output"
  filename: "requirements.md"
  save_intermediate: true
```

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œ

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®
uv run python main.py /path/to/repo

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
uv run python main.py /path/to/repo -c config.yaml

# æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
uv run python main.py /path/to/repo -v
```

### Python API

```python
from llm_workflow import run_workflow

# è¿è¡Œå·¥ä½œæµ
final_state = run_workflow(
    repo_path="/path/to/repo",
    config_path="config.yaml"
)

# æ£€æŸ¥ç»“æœ
if final_state["status"] == "completed":
    print("æ–‡æ¡£ç”ŸæˆæˆåŠŸï¼")
    print(f"è¾“å‡ºæ–‡ä»¶: {final_state['current_document'][:500]}...")
else:
    print(f"ç”Ÿæˆå¤±è´¥: {final_state['error']}")
```

## è¾“å‡º

è¿è¡Œåä¼šåœ¨ä»“åº“ç›®å½•ä¸‹ç”Ÿæˆ `repo2doc-output/` æ–‡ä»¶å¤¹ï¼š

```
repo2doc-output/
â”œâ”€â”€ requirements.md           # æœ€ç»ˆéœ€æ±‚æ–‡æ¡£
â”œâ”€â”€ 2024-01-01_12-00-00_requirements.md  # å¸¦æ—¶é—´æˆ³çš„å¤‡ä»½
â”œâ”€â”€ 2024-01-01_12-00-00_report.md        # å¤„ç†æŠ¥å‘Š
â””â”€â”€ intermediate/             # ä¸­é—´ç»“æœï¼ˆå¦‚æœå¯ç”¨ï¼‰
    â”œâ”€â”€ chunk_1.md
    â”œâ”€â”€ chunk_2.md
    â””â”€â”€ ...
```

## é¡¹ç›®ç»“æ„

```
repo2doc/
â”œâ”€â”€ main.py              # ä¸»å…¥å£
â”œâ”€â”€ llm_workflow.py      # LangGraph å·¥ä½œæµå®šä¹‰
â”œâ”€â”€ state.py             # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ config_loader.py     # é…ç½®åŠ è½½å™¨
â”œâ”€â”€ config.yaml          # é»˜è®¤é…ç½®
â”œâ”€â”€ nodes/               # å·¥ä½œæµèŠ‚ç‚¹
â”‚   â”œâ”€â”€ node1_scan_files.py
â”‚   â”œâ”€â”€ node2_filter_files.py
â”‚   â”œâ”€â”€ node3_chunk_files.py
â”‚   â”œâ”€â”€ node4_generate_doc.py
â”‚   â””â”€â”€ node5_save_output.py
â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ token_counter.py
â”‚   â””â”€â”€ file_utils.py
â”œâ”€â”€ tests/               # æµ‹è¯•
â”‚   â””â”€â”€ test_workflow.py
â”œâ”€â”€ pyproject.toml       # é¡¹ç›®é…ç½®
â”œâ”€â”€ .env.example         # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ readme.cn.md         # ä¸­æ–‡æ–‡æ¡£
â””â”€â”€ readme.en.md         # è‹±æ–‡æ–‡æ¡£
```

## æŠ€æœ¯åŸç†

### å¢é‡å¼æ–‡æ¡£ç”Ÿæˆ

ç”±äºä»£ç åº“å¯èƒ½è¶…è¿‡ LLM çš„ä¸Šä¸‹æ–‡é™åˆ¶ï¼ŒRepo2Doc é‡‡ç”¨å¢é‡å¼ç”Ÿæˆç­–ç•¥ï¼š

1. **é¦–æ¬¡ç”Ÿæˆ**ï¼šä½¿ç”¨ç¬¬ä¸€ä¸ªä»£ç å—ç”Ÿæˆåˆå§‹æ–‡æ¡£
2. **å¢é‡æ›´æ–°**ï¼šåç»­ä»£ç å—ä¸ä¹‹å‰çš„æ–‡æ¡£ä¸€èµ·è¾“å…¥ LLM
3. **åˆå¹¶ç­–ç•¥**ï¼šLLM å°†æ–°å‘ç°çš„åŠŸèƒ½åˆå¹¶åˆ°ç°æœ‰æ–‡æ¡£ä¸­

```
å— 1 â†’ æ–‡æ¡£ v1
å— 2 + æ–‡æ¡£ v1 â†’ æ–‡æ¡£ v2
å— 3 + æ–‡æ¡£ v2 â†’ æ–‡æ¡£ v3
...
å— N + æ–‡æ¡£ v(N-1) â†’ æœ€ç»ˆæ–‡æ¡£
```

### åˆ†å—ç­–ç•¥

```python
# è®¡ç®—æ¯ä¸ªå—çš„æœ€å¤§ token æ•°
max_tokens_per_chunk = max_input_tokens - reserved_tokens

# æŒ‰é¡ºåºå°†æ–‡ä»¶æ·»åŠ åˆ°å½“å‰å—
for file in files:
    if current_tokens + file_tokens > max_tokens_per_chunk:
        # åˆ›å»ºæ–°å—
        save_current_chunk()
        start_new_chunk()
    add_file_to_chunk(file)
```

## ä¸ swark çš„å¯¹æ¯”

| ç‰¹æ€§ | Repo2Doc | swark |
|------|----------|-------|
| **è¾“å‡ºç±»å‹** | éœ€æ±‚æ–‡æ¡£ | æ¶æ„å›¾ |
| **LLM æ¡†æ¶** | LangGraph | VS Code API |
| **åˆ†å—ç­–ç•¥** | å¢é‡å¼æ›´æ–° | æˆªæ–­ |
| **æ–‡ä»¶ç­›é€‰** | ç±»ä¼¼ | ç±»ä¼¼ |
| **è¿è¡Œç¯å¢ƒ** | å‘½ä»¤è¡Œ/Python | VS Code æ‰©å±• |

## è®¸å¯è¯

MIT License
